<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××ª×›×•× ×™× - ×˜×¢× ×©×œ ×‘×™×ª | ××ª×›×•× ×™× ×œ×›×œ ×¨×’×¢</title>
    <meta name="description" content="××•×¡×£ ××ª×›×•× ×™× ×‘×™×ª×™×™× ×˜×¢×™××™× ×•×§×œ×™× ×œ×”×›× ×”. ×©×§×©×•×§×”, ×¤×¡×˜×”, ×¢×•×’×•×ª ×•×¢×•×“ - ×›×œ ×”××ª×›×•× ×™× ×‘××§×•× ××—×“!">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/favicon.svg">
    <meta property="og:title" content="××ª×›×•× ×™× - ×˜×¢× ×©×œ ×‘×™×ª">
    <meta property="og:description" content="××ª×›×•× ×™× ×œ×›×œ ×¨×’×¢ - ××•×¡×£ ××ª×›×•× ×™× ×‘×™×ª×™×™× ×˜×¢×™××™×">
    <meta property="og:image" content="/hero-banner.png">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // ×˜×¢×™× ×ª ××ª×›×•× ×™× ××§×•×‘×¥ JSON
        let allRecipes = [];
        fetch('data/recipes.json')
            .then(response => response.json())
            .then(data => {
                allRecipes = data;
                window.dispatchEvent(new Event('recipesLoaded'));
            })
            .catch(err => {
                console.error('Error loading recipes:', err);
                // Fallback to recipes_data.js if JSON fails
                if (typeof recipes !== 'undefined') {
                    allRecipes = recipes;
                }
            });
    </script>
    <script src="recipes_data.js"></script>
    <script src="features.js" defer></script>
    <script src="schema-generator.js" defer></script>
    <style>
        * { font-family: 'Heebo', sans-serif; }
        .step-number {
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Smooth animations */
        .recipe-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .recipe-card:hover { transform: translateY(-8px) scale(1.02); }
        .recipe-card img { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .recipe-card:hover img { transform: scale(1.15); }

        /* Modal tabs */
        .modal-tab { transition: all 0.2s ease; border-bottom: 3px solid transparent; }
        .modal-tab.active { border-color: #f97316; color: #f97316; }
        .modal-tab:hover:not(.active) { color: #ea580c; }

        /* Share button animation */
        .share-btn { transition: all 0.2s ease; }
        .share-btn:hover { transform: scale(1.1); }
        .share-btn:active { transform: scale(0.95); }

        /* Hero recipe card glow */
        .hero-recipe-card {
            animation: subtle-glow 3s ease-in-out infinite;
        }
        @keyframes subtle-glow {
            0%, 100% { box-shadow: 0 20px 40px rgba(249, 115, 22, 0.2); }
            50% { box-shadow: 0 25px 50px rgba(249, 115, 22, 0.35); }
        }

        /* Scrollbar hide for category pills */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Toast notification */
        .toast {
            animation: toast-in 0.3s ease, toast-out 0.3s ease 2.7s forwards;
        }
        @keyframes toast-in {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes toast-out {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 min-h-screen">
    <div id="app"></div>
    <script>
const cats = ["×”×›×œ", "××¨×•×—×ª ×‘×•×§×¨", "×× ×•×ª ×¢×™×§×¨×™×•×ª", "×ª×•×¡×¤×•×ª", "×¡×œ×˜×™×", "×§×™× ×•×—×™×", "××¨×§×™×", "×××¤×™×"];
const ings = ["×”×›×œ", "×‘×™×¦×™×", "×¢×•×£", "×‘×©×¨", "×“×’", "×™×¨×§×•×ª", "×¤×¡×˜×”", "××•×¨×–", "×’×‘×™× ×”", "×©×•×§×•×œ×“", "×§××—", "×§×˜× ×™×•×ª", "××‘×•×§×“×•", "×¢×’×‘× ×™×•×ª", "×©×™×‘×•×œ×ª ×©×•×¢×œ"];
const diets = ["×”×›×œ", "×˜×‘×¢×•× ×™", "×¦××—×•× ×™", "×œ×œ× ×’×œ×•×˜×Ÿ", "×‘×¨×™×"];
const diffs = ["×”×›×œ", "×§×œ", "×‘×™× ×•× ×™", "××ª×§×“×"];

let state = {
    cat: "×”×›×œ",
    ing: "×”×›×œ",
    diet: "×”×›×œ",
    diff: "×”×›×œ",
    q: "",
    favs: JSON.parse(localStorage.getItem('favs') || '[]'),
    showFav: false,
    modal: null,
    showFilter: false,
    showHero: true,
    visibleCount: 8,
    activeTab: 'ingredients',
    servings: null // for serving calculator
};

// Get recipe of the day based on date
function getRecipeOfDay() {
    const today = new Date();
    const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
    return allRecipes[dayOfYear % allRecipes.length];
}

// Get time-based greeting and suggestion
function getTimeBasedContent() {
    const hour = new Date().getHours();
    if (hour >= 5 && hour < 11) {
        return { greeting: "×‘×•×§×¨ ×˜×•×‘! â˜€ï¸", suggestion: "××” ×œ××¨×•×—×ª ×‘×•×§×¨?", cat: "××¨×•×—×ª ×‘×•×§×¨" };
    } else if (hour >= 11 && hour < 15) {
        return { greeting: "×¦×”×¨×™×™× ×˜×•×‘×™×! ğŸŒ¤ï¸", suggestion: "×¨×¢×™×•× ×•×ª ×œ×¦×”×¨×™×™×", cat: "×× ×•×ª ×¢×™×§×¨×™×•×ª" };
    } else if (hour >= 15 && hour < 18) {
        return { greeting: "××—×¨ ×¦×”×¨×™×™× × ×¢×™××™×! ğŸª", suggestion: "××©×”×• ××ª×•×§?", cat: "×§×™× ×•×—×™×" };
    } else if (hour >= 18 && hour < 22) {
        return { greeting: "×¢×¨×‘ ×˜×•×‘! ğŸŒ™", suggestion: "××” ×œ××¨×•×—×ª ×¢×¨×‘?", cat: "×× ×•×ª ×¢×™×§×¨×™×•×ª" };
    } else {
        return { greeting: "×œ×™×œ×” ×˜×•×‘! ğŸŒŸ", suggestion: "×—×˜×™×£ ×œ×™×œ×™?", cat: "×§×™× ×•×—×™×" };
    }
}

// Show toast notification
function showToast(message) {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();

    const toast = document.createElement('div');
    toast.className = 'toast fixed bottom-6 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-[100] flex items-center gap-2';
    toast.innerHTML = `<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>${message}`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Share functions
function shareWhatsApp(recipe) {
    const text = `ğŸ³ ××ª×›×•×Ÿ ××•××œ×¥: ${recipe.title}%0A${recipe.subtitle}%0A%0Aâ±ï¸ ×–××Ÿ ×”×›× ×”: ${recipe.totalTime}%0AğŸ‘¥ ×× ×•×ª: ${recipe.srv}%0A%0A×œ××ª×›×•×Ÿ ×”××œ×: ${window.location.href}`;
    window.open(`https://wa.me/?text=${text}`, '_blank');
}

function copyLink(recipe) {
    navigator.clipboard.writeText(window.location.href).then(() => {
        showToast('×”×§×™×©×•×¨ ×”×•×¢×ª×§! ğŸ“‹');
    });
}

// Print recipe function
function printRecipe(recipe) {
    const printWindow = window.open('', '_blank');
    const servings = state.servings || recipe.srv;
    const ratio = servings / recipe.srv;

    printWindow.document.write(`
        <!DOCTYPE html>
        <html lang="he" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>${recipe.title} - ××ª×›×•×Ÿ ×œ×”×“×¤×¡×”</title>
            <style>
                * { font-family: 'Arial', sans-serif; }
                body { padding: 20px; max-width: 800px; margin: 0 auto; }
                h1 { color: #ea580c; margin-bottom: 5px; }
                .subtitle { color: #666; margin-bottom: 20px; }
                .meta { display: flex; gap: 20px; padding: 15px 0; border-bottom: 2px solid #ea580c; margin-bottom: 20px; }
                .meta span { display: flex; align-items: center; gap: 5px; }
                h2 { color: #333; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
                ul { padding-right: 20px; }
                li { margin-bottom: 8px; line-height: 1.6; }
                ol li { margin-bottom: 12px; }
                .tips { background: #fff7ed; padding: 15px; border-radius: 8px; margin-top: 20px; }
                .tips p { margin: 5px 0; }
                .footer { margin-top: 30px; text-align: center; color: #999; font-size: 12px; border-top: 1px solid #ddd; padding-top: 15px; }
                @media print { body { padding: 0; } }
            </style>
        </head>
        <body>
            <h1>${recipe.title}</h1>
            <p class="subtitle">${recipe.subtitle || ''}</p>
            <div class="meta">
                <span>â±ï¸ ${recipe.totalTime}</span>
                <span>ğŸ‘¥ ${servings} ×× ×•×ª</span>
                <span>ğŸ“Š ${recipe.diff}</span>
            </div>
            <h2>××¦×¨×›×™×</h2>
            <ul>
                ${recipe.ingr.map(i => {
                    if (ratio !== 1) {
                        return `<li>${scaleIngredient(i, ratio)}</li>`;
                    }
                    return `<li>${i}</li>`;
                }).join('')}
            </ul>
            <h2>××•×¤×Ÿ ×”×”×›× ×”</h2>
            <ol>
                ${recipe.inst.map(s => `<li>${s}</li>`).join('')}
            </ol>
            ${recipe.tips && recipe.tips.length ? `
            <div class="tips">
                <h3>ğŸ’¡ ×˜×™×¤×™×</h3>
                ${recipe.tips.map(t => `<p>${t}</p>`).join('')}
            </div>
            ` : ''}
            <div class="footer">
                ××ª×›×•×Ÿ ×××ª×¨ "×˜×¢× ×©×œ ×‘×™×ª" | matkunim.co.il
            </div>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

// Scale ingredient quantities
function scaleIngredient(ingredient, ratio) {
    // Match numbers (including fractions like Â½, Â¼, Â¾)
    const fractionMap = { 'Â½': 0.5, 'Â¼': 0.25, 'Â¾': 0.75, 'â…“': 0.33, 'â…”': 0.67 };

    return ingredient.replace(/(\d+\.?\d*|[Â½Â¼Â¾â…“â…”])/g, (match) => {
        if (fractionMap[match]) {
            const result = fractionMap[match] * ratio;
            return formatNumber(result);
        }
        const num = parseFloat(match);
        if (!isNaN(num)) {
            const result = num * ratio;
            return formatNumber(result);
        }
        return match;
    });
}

// Format number nicely
function formatNumber(num) {
    if (num === Math.floor(num)) return num.toString();
    if (Math.abs(num - 0.25) < 0.05) return 'Â¼';
    if (Math.abs(num - 0.5) < 0.05) return 'Â½';
    if (Math.abs(num - 0.75) < 0.05) return 'Â¾';
    if (Math.abs(num - 0.33) < 0.05) return 'â…“';
    if (Math.abs(num - 0.67) < 0.05) return 'â…”';
    return num.toFixed(1).replace('.0', '');
}

// Get scaled ingredients for display
function getScaledIngredients(recipe) {
    const servings = state.servings || recipe.srv;
    const ratio = servings / recipe.srv;
    if (ratio === 1) return recipe.ingr;
    return recipe.ingr.map(i => scaleIngredient(i, ratio));
}

function saveFavs() {
    localStorage.setItem('favs', JSON.stringify(state.favs));
}

function getFilteredRecipes() {
    return allRecipes.filter(r => {
        if (state.showFav && !state.favs.includes(r.id)) return false;
        if (state.cat !== "×”×›×œ" && r.cat !== state.cat) return false;
        if (state.ing !== "×”×›×œ" && r.ing !== state.ing) return false;
        if (state.diet !== "×”×›×œ" && !r.diet.includes(state.diet)) return false;
        if (state.diff !== "×”×›×œ" && r.diff !== state.diff) return false;
        if (state.q && !r.title.includes(state.q) && !r.ingr.some(i => i.includes(state.q))) return false;
        return true;
    });
}

function render() {
    const allFiltered = getFilteredRecipes();
    const visible = allFiltered.slice(0, state.visibleCount);
    const hasMore = allFiltered.length > state.visibleCount;

    document.getElementById("app").innerHTML = `
    ${state.showHero ? (() => {
        const rotd = getRecipeOfDay();
        const timeContent = getTimeBasedContent();
        return `
    <section class="relative bg-gradient-to-br from-orange-50 via-amber-50 to-rose-50 py-12 px-4">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col lg:flex-row items-center gap-8 lg:gap-12">
                <!-- Left: Greeting & Quick Actions -->
                <div class="flex-1 text-center lg:text-right">
                    <p class="text-lg text-orange-600 font-medium mb-2">${timeContent.greeting}</p>
                    <h1 class="text-4xl md:text-5xl font-black text-gray-800 mb-4">××” ××‘×©×œ×™× ×”×™×•×?</h1>
                    <p class="text-gray-600 text-lg mb-6">×’×œ×• ××ª×›×•× ×™× ×‘×™×ª×™×™× ×˜×¢×™××™× ×•×§×œ×™× ×œ×”×›× ×”</p>

                    <div class="flex flex-wrap gap-3 justify-center lg:justify-start mb-6">
                        <button onclick="state.cat='${timeContent.cat}';state.showHero=false;state.visibleCount=8;render();" class="px-5 py-2.5 bg-gradient-to-r from-orange-500 to-rose-500 text-white rounded-full font-medium shadow-lg hover:shadow-xl transition-all hover:scale-105">
                            ${timeContent.suggestion} â†’
                        </button>
                        <button onclick="state.showHero=false;render();" class="px-5 py-2.5 bg-white text-gray-700 rounded-full font-medium shadow-md hover:shadow-lg transition-all border border-gray-200">
                            ×›×œ ×”××ª×›×•× ×™×
                        </button>
                    </div>

                    <div class="flex items-center gap-4 justify-center lg:justify-start text-sm text-gray-500">
                        <span class="flex items-center gap-1"><span class="text-orange-500 font-bold">${allRecipes.length}</span> ××ª×›×•× ×™×</span>
                        <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                        <span class="flex items-center gap-1"><span class="text-orange-500 font-bold">${cats.length - 1}</span> ×§×˜×’×•×¨×™×•×ª</span>
                        <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                        <span>100% ×—×™× ×</span>
                    </div>
                </div>

                <!-- Right: Recipe of the Day Card -->
                <div class="flex-1 max-w-md w-full">
                    <div class="text-center mb-3">
                        <span class="inline-flex items-center gap-2 px-4 py-1.5 bg-orange-100 text-orange-700 rounded-full text-sm font-medium">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>
                            ××ª×›×•×Ÿ ×”×™×•×
                        </span>
                    </div>
                    <div class="hero-recipe-card bg-white rounded-3xl overflow-hidden cursor-pointer group" onclick="state.modal=allRecipes.find(r=>r.id==${rotd.id});render();">
                        <div class="relative h-52 overflow-hidden">
                            <img src="${rotd.img}" alt="${rotd.title}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                            <div class="absolute bottom-4 right-4 left-4">
                                <span class="px-2 py-1 bg-white/90 rounded-full text-xs font-medium text-gray-700 mb-2 inline-block">${rotd.cat}</span>
                                <h3 class="text-2xl font-bold text-white">${rotd.title}</h3>
                            </div>
                        </div>
                        <div class="p-4">
                            <p class="text-gray-600 text-sm mb-3">${rotd.subtitle}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex gap-4 text-sm text-gray-500">
                                    <span class="flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                        ${rotd.totalTime}
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                                        ${rotd.srv} ×× ×•×ª
                                    </span>
                                </div>
                                <span class="text-orange-500 font-medium text-sm group-hover:translate-x-[-4px] transition-transform">×œ×¦×¤×™×™×” ×‘××ª×›×•×Ÿ â†</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    `;
    })() : ''}

    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-orange-100 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between gap-4 flex-wrap">
                <div class="flex items-center gap-3 cursor-pointer" onclick="state.showHero=true;render();">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-orange-400 to-rose-500 flex items-center justify-center shadow-lg shadow-orange-200">
                        <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z"/><path d="M6 17h12"/></svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black bg-gradient-to-r from-orange-600 to-rose-600 bg-clip-text text-transparent">×˜×¢× ×©×œ ×‘×™×ª</h1>
                        <p class="text-xs text-gray-500">××ª×›×•× ×™× ×œ×›×œ ×¨×’×¢</p>
                    </div>
                </div>
                <nav class="hidden md:flex gap-2">
                    <a href="/tips.html" class="px-3 py-2 text-gray-600 hover:text-orange-600 text-sm font-medium transition-colors">ğŸ’¡ ×˜×™×¤×™×</a>
                    <button onclick="openFridgeModal()" class="px-3 py-2 text-cyan-600 hover:text-cyan-700 text-sm font-medium transition-colors bg-cyan-50 rounded-lg hover:bg-cyan-100">ğŸ§Š ××” ×‘××§×¨×¨?</button>
                    <a href="/conversions.html" class="px-3 py-2 text-gray-600 hover:text-orange-600 text-sm font-medium transition-colors">âš–ï¸ ×”××¨×•×ª</a>
                    <a href="/about.html" class="px-3 py-2 text-gray-600 hover:text-orange-600 text-sm font-medium transition-colors">â„¹ï¸ ××•×“×•×ª</a>
                </nav>
                <div class="flex-1 max-w-md min-w-[200px] relative">
                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input id="search" type="text" placeholder="×—×™×¤×•×© ××ª×›×•× ×™×..." value="${state.q}" class="w-full pr-12 pl-4 py-3 rounded-2xl bg-gray-50 border border-gray-200 focus:border-orange-400 outline-none text-gray-700">
                </div>
                <div class="flex gap-2">
                    <button id="filterBtn" class="p-3 rounded-xl ${state.showFilter ? 'bg-orange-500 text-white' : 'bg-gray-100 text-gray-600'} transition-all">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                    </button>
                    <button id="favBtn" class="p-3 rounded-xl flex items-center gap-2 ${state.showFav ? 'bg-rose-500 text-white' : 'bg-gray-100 text-gray-600'} transition-all">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="${state.showFav ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                        ${state.favs.length ? `<span class="text-sm font-bold">${state.favs.length}</span>` : ''}
                    </button>
                </div>
            </div>
            <div class="mt-4 flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                ${cats.map(c => `<button class="cat-btn px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium transition-all ${state.cat === c ? 'bg-gradient-to-r from-orange-500 to-rose-500 text-white shadow-lg' : 'bg-white text-gray-600 border border-gray-200 hover:border-orange-300'}" data-cat="${c}">${c}</button>`).join('')}
            </div>
            ${state.showFilter ? `
            <div class="mt-4 p-4 bg-white rounded-2xl border border-gray-200 shadow-lg">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">××¨×›×™×‘ ×¢×™×§×¨×™</label>
                        <select id="ingFilter" class="w-full p-2 rounded-xl border bg-gray-50">
                            ${ings.map(i => `<option ${state.ing === i ? 'selected' : ''}>${i}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">×¡×’× ×•×Ÿ ×ª×–×•× ×”</label>
                        <select id="dietFilter" class="w-full p-2 rounded-xl border bg-gray-50">
                            ${diets.map(d => `<option ${state.diet === d ? 'selected' : ''}>${d}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">×¨××ª ×§×•×©×™</label>
                        <select id="diffFilter" class="w-full p-2 rounded-xl border bg-gray-50">
                            ${diffs.map(d => `<option ${state.diff === d ? 'selected' : ''}>${d}</option>`).join('')}
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button id="resetBtn" class="w-full p-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 font-medium">ğŸ”„ ××¤×¡ ×¤×™×œ×˜×¨×™×</button>
                    </div>
                </div>
            </div>
            ` : ''}
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex items-center gap-2 mb-6 text-gray-600">
            <svg class="w-5 h-5 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
            <span class="font-medium">${state.showFav ? '×”××•×¢×“×¤×™× ×©×œ×š' : `${allFiltered.length} ××ª×›×•× ×™× × ××¦××•`}</span>
        </div>

        ${visible.length ? `
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            ${visible.map(r => `
            <div class="recipe-card group bg-white rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-100 hover:border-orange-200 hover:-translate-y-1" data-id="${r.id}">
                <div class="relative h-48 overflow-hidden">
                    <img src="${r.img}" alt="${r.title}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
                    <span class="absolute top-3 right-3 px-3 py-1 bg-white/90 rounded-full text-xs font-medium text-gray-700">${r.cat}</span>
                    <button class="fav-btn absolute top-3 left-3 w-10 h-10 rounded-full flex items-center justify-center transition-all ${state.favs.includes(r.id) ? 'bg-rose-500 text-white' : 'bg-white/90 text-gray-600 hover:bg-rose-100'}" data-id="${r.id}">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="${state.favs.includes(r.id) ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    </button>
                    ${r.diet && r.diet.length ? `<div class="absolute bottom-3 right-3 flex gap-1">${r.diet.slice(0, 2).map(d => `<span class="px-2 py-1 bg-green-500/90 rounded-full text-xs font-medium text-white">${d}</span>`).join('')}</div>` : ''}
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-1 group-hover:text-orange-600 transition-colors">${r.title}</h3>
                    <p class="text-sm text-gray-500 mb-3 line-clamp-1">${r.subtitle || ''}</p>
                    <div class="flex gap-3 text-sm text-gray-500">
                        <span class="flex items-center gap-1"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>${r.totalTime}</span>
                        <span class="flex items-center gap-1"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>${r.srv} ×× ×•×ª</span>
                        <span class="flex items-center gap-1 ${r.diff === '×§×œ' ? 'text-green-600' : r.diff === '×‘×™× ×•× ×™' ? 'text-yellow-600' : 'text-red-600'}">${r.diff}</span>
                    </div>
                </div>
            </div>
            `).join('')}
        </div>
        ${hasMore ? `
        <div class="text-center mt-10">
            <button id="loadMore" class="px-8 py-4 bg-gradient-to-r from-orange-500 to-rose-500 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105">
                ×˜×¢×Ÿ ×¢×•×“ ××ª×›×•× ×™× (${allFiltered.length - state.visibleCount} × ×•×¡×¤×™×)
            </button>
        </div>
        ` : ''}
        ` : `
        <div class="text-center py-20">
            <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
                <svg class="w-12 h-12 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            </div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">×œ× × ××¦××• ××ª×›×•× ×™×</h3>
            <p class="text-gray-500 mb-4">× ×¡×• ×œ×©× ×•×ª ××ª ×”×¤×™×œ×˜×¨×™×</p>
            <button id="showAll" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-rose-500 text-white rounded-xl font-medium shadow-lg">×”×¦×™×’×• ××ª ×›×œ ×”××ª×›×•× ×™×</button>
        </div>
        `}
    </main>

    ${state.modal ? renderModal(state.modal) : ''}

    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 py-8 text-center">
            <div class="flex items-center justify-center gap-2 mb-4">
                <svg class="w-6 h-6 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z"/><path d="M6 17h12"/></svg>
                <span class="text-xl font-bold text-gray-800">×˜×¢× ×©×œ ×‘×™×ª</span>
            </div>
            <p class="text-gray-500 text-sm">××ª×›×•× ×™× ×œ×›×œ ×¨×’×¢</p>
            <div class="flex justify-center gap-4 mt-4">
                <a href="/" class="text-gray-400 hover:text-orange-500">××ª×›×•× ×™×</a>
                <a href="/tips.html" class="text-gray-400 hover:text-orange-500">×˜×™×¤×™×</a>
                <a href="/conversions.html" class="text-gray-400 hover:text-orange-500">×”××¨×•×ª</a>
                <a href="/about.html" class="text-gray-400 hover:text-orange-500">××•×“×•×ª</a>
            </div>
            <p class="text-gray-400 text-xs mt-4">Â© 2025 ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
        </div>
    </footer>`;

    addEvents();
}

function renderModal(r) {
    const currentServings = state.servings || r.srv;
    const scaledIngredients = getScaledIngredients(r);

    return `
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" id="modalOverlay">
        <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl flex flex-col" onclick="event.stopPropagation()">
            <!-- Header Image -->
            <div class="relative h-52 flex-shrink-0">
                <img src="${r.img}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>

                <!-- Top buttons -->
                <div class="absolute top-4 left-4 right-4 flex justify-between">
                    <button id="closeModal" class="w-10 h-10 rounded-full bg-white/90 flex items-center justify-center hover:bg-white transition-all shadow-lg">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                    <div class="flex gap-2">
                        <button onclick="printRecipe(allRecipes.find(r=>r.id==${r.id}))" class="share-btn w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center shadow-lg" title="×”×“×¤×¡ ××ª×›×•×Ÿ">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
                        </button>
                        <button onclick="shareWhatsApp(allRecipes.find(r=>r.id==${r.id}))" class="share-btn w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center shadow-lg" title="×©×ª×£ ×‘×•×•××˜×¡××¤">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        </button>
                        <button onclick="copyLink(allRecipes.find(r=>r.id==${r.id}))" class="share-btn w-10 h-10 rounded-full bg-gray-700 text-white flex items-center justify-center shadow-lg" title="×”×¢×ª×§ ×§×™×©×•×¨">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                        </button>
                        <button onclick="startVoiceCooking(allRecipes.find(r=>r.id==${r.id}))" class="share-btn w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white flex items-center justify-center shadow-lg" title="×‘×™×©×•×œ ×§×•×œ×™">
                            ğŸ™ï¸
                        </button>
                        <button onclick="openGalleryModal(${r.id})" class="share-btn w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 text-white flex items-center justify-center shadow-lg" title="×’×œ×¨×™×” ×§×”×™×œ×ª×™×ª">
                            ğŸ“¸
                        </button>
                        <button class="modal-fav w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg ${state.favs.includes(r.id) ? 'bg-rose-500 text-white' : 'bg-white/90 text-gray-600 hover:bg-rose-100'}" data-id="${r.id}">
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="${state.favs.includes(r.id) ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                        </button>
                    </div>
                </div>

                <!-- Title section -->
                <div class="absolute bottom-4 right-4 left-4">
                    <span class="px-3 py-1 bg-orange-500 rounded-full text-xs font-medium text-white mb-2 inline-block">${r.cat}</span>
                    <h2 class="text-2xl font-bold text-white">${r.title}</h2>
                    <p class="text-white/80 text-sm">${r.subtitle || ''}</p>
                </div>
            </div>

            <!-- Sticky Info Bar -->
            <div class="sticky top-0 z-10 bg-white border-b border-gray-100 px-6 py-3 flex-shrink-0">
                <div class="flex flex-wrap items-center justify-between gap-3">
                    <div class="flex flex-wrap gap-2">
                        <span class="flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 rounded-lg text-sm">
                            <svg class="w-4 h-4 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span class="text-gray-600">${r.totalTime}</span>
                        </span>
                        <!-- Serving Calculator -->
                        <span class="flex items-center gap-1.5 px-2 py-1 bg-green-50 rounded-lg text-sm">
                            <svg class="w-4 h-4 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                            <button id="servingMinus" class="w-6 h-6 rounded-full bg-green-200 hover:bg-green-300 flex items-center justify-center text-green-700 font-bold transition-colors">âˆ’</button>
                            <span class="text-gray-700 font-bold min-w-[2ch] text-center" id="servingCount">${currentServings}</span>
                            <button id="servingPlus" class="w-6 h-6 rounded-full bg-green-200 hover:bg-green-300 flex items-center justify-center text-green-700 font-bold transition-colors">+</button>
                            <span class="text-gray-600">×× ×•×ª</span>
                            ${currentServings !== r.srv ? `<button id="resetServings" class="text-xs text-green-600 hover:underline mr-1">(××™×¤×•×¡)</button>` : ''}
                        </span>
                        <span class="flex items-center gap-1.5 px-3 py-1.5 bg-purple-50 rounded-lg text-sm">
                            <span class="font-medium ${r.diff === '×§×œ' ? 'text-green-600' : r.diff === '×‘×™× ×•× ×™' ? 'text-yellow-600' : 'text-red-600'}">${r.diff}</span>
                        </span>
                        ${r.diet && r.diet.length ? r.diet.map(d => `<span class="px-3 py-1.5 bg-emerald-50 rounded-lg text-emerald-700 text-sm">${d}</span>`).join('') : ''}
                    </div>

                    <!-- Tabs -->
                    <div class="flex gap-1 bg-gray-100 rounded-lg p-1">
                        <button class="modal-tab px-4 py-1.5 rounded-md text-sm font-medium ${state.activeTab === 'ingredients' ? 'bg-white shadow-sm text-orange-600' : 'text-gray-600'}" data-tab="ingredients">××¦×¨×›×™×</button>
                        <button class="modal-tab px-4 py-1.5 rounded-md text-sm font-medium ${state.activeTab === 'instructions' ? 'bg-white shadow-sm text-orange-600' : 'text-gray-600'}" data-tab="instructions">×”×›× ×”</button>
                        ${r.tips && r.tips.length ? `<button class="modal-tab px-4 py-1.5 rounded-md text-sm font-medium ${state.activeTab === 'tips' ? 'bg-white shadow-sm text-orange-600' : 'text-gray-600'}" data-tab="tips">×˜×™×¤×™×</button>` : ''}
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="p-4 overflow-y-auto flex-1">
                <!-- Ingredients Tab -->
                <div class="${state.activeTab === 'ingredients' ? '' : 'hidden'}">
                    <div class="flex items-center gap-2 text-lg font-bold text-gray-800 mb-3">
                        <span class="w-8 h-8 rounded-lg bg-orange-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-orange-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        </span>
                        ××¦×¨×›×™× (${r.ingr.length})
                        ${currentServings !== r.srv ? `<span class="text-sm font-normal text-orange-500 mr-2">××•×ª×× ×œ-${currentServings} ×× ×•×ª</span>` : ''}
                    </div>
                    <div class="grid sm:grid-cols-2 gap-2">
                        ${scaledIngredients.map((i, idx) => `
                        <label class="flex items-center gap-2 p-2.5 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-orange-500 focus:ring-orange-500">
                            <span class="text-gray-700 group-hover:text-gray-900">${i}</span>
                        </label>
                        `).join('')}
                    </div>
                </div>

                <!-- Instructions Tab -->
                <div class="${state.activeTab === 'instructions' ? '' : 'hidden'}">
                    <div class="flex items-center gap-2 text-lg font-bold text-gray-800 mb-3">
                        <span class="w-8 h-8 rounded-lg bg-rose-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-rose-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z"/><path d="M6 17h12"/></svg>
                        </span>
                        ××•×¤×Ÿ ×”×”×›× ×” (${r.inst.length} ×©×œ×‘×™×)
                    </div>
                    <ol class="space-y-4">
                        ${r.inst.map((s, i) => `
                        <li class="flex gap-2 items-start p-2.5 bg-gray-50 rounded-lg hover:bg-orange-50 transition-colors">
                            <span class="step-number rounded-full bg-gradient-to-br from-orange-400 to-rose-500 text-white text-sm font-bold flex-shrink-0">${i + 1}</span>
                            <span class="text-gray-700 leading-relaxed">${s}</span>
                        </li>
                        `).join('')}
                    </ol>
                </div>

                <!-- Tips Tab -->
                ${r.tips && r.tips.length ? `
                <div class="${state.activeTab === 'tips' ? '' : 'hidden'}">
                    <div class="flex items-center gap-2 text-lg font-bold text-gray-800 mb-3">
                        <span class="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center">ğŸ’¡</span>
                        ×˜×™×¤×™× ×œ×”×¦×œ×—×”
                    </div>
                    <div class="space-y-3">
                        ${r.tips.map(t => `
                        <div class="p-3 bg-amber-50 rounded-lg border border-amber-200 text-amber-800">
                            ${t}
                        </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            </div>
        </div>
    </div>`;
}

function addEvents() {
    document.getElementById("search")?.addEventListener("input", e => {
        state.q = e.target.value;
        state.visibleCount = 8;
        const cursorPos = e.target.selectionStart;
        render();
        // Restore focus and cursor position after re-render
        const searchInput = document.getElementById("search");
        if (searchInput) {
            searchInput.focus();
            searchInput.setSelectionRange(cursorPos, cursorPos);
        }
    });
    document.getElementById("filterBtn")?.addEventListener("click", () => { state.showFilter = !state.showFilter; render(); });
    document.getElementById("favBtn")?.addEventListener("click", () => { state.showFav = !state.showFav; state.visibleCount = 8; render(); });
    document.querySelectorAll(".cat-btn").forEach(b => b.addEventListener("click", () => { state.cat = b.dataset.cat; state.visibleCount = 8; render(); }));
    document.getElementById("ingFilter")?.addEventListener("change", e => { state.ing = e.target.value; state.visibleCount = 8; render(); });
    document.getElementById("dietFilter")?.addEventListener("change", e => { state.diet = e.target.value; state.visibleCount = 8; render(); });
    document.getElementById("diffFilter")?.addEventListener("change", e => { state.diff = e.target.value; state.visibleCount = 8; render(); });
    document.getElementById("resetBtn")?.addEventListener("click", () => { state = { ...state, cat: "×”×›×œ", ing: "×”×›×œ", diet: "×”×›×œ", diff: "×”×›×œ", q: "", showFav: false, visibleCount: 8 }; render(); });
    document.getElementById("showAll")?.addEventListener("click", () => { state = { ...state, cat: "×”×›×œ", ing: "×”×›×œ", diet: "×”×›×œ", diff: "×”×›×œ", q: "", showFav: false, visibleCount: 8 }; render(); });
    document.getElementById("loadMore")?.addEventListener("click", () => { state.visibleCount += 8; render(); });
    document.querySelectorAll(".recipe-card").forEach(c => c.addEventListener("click", e => { if (!e.target.closest(".fav-btn")) { state.modal = allRecipes.find(r => r.id == c.dataset.id); state.activeTab = 'ingredients'; state.servings = null; render(); } }));
    document.querySelectorAll(".fav-btn").forEach(b => b.addEventListener("click", e => { e.stopPropagation(); toggleFav(parseInt(b.dataset.id)); }));
    document.querySelectorAll(".modal-fav").forEach(b => b.addEventListener("click", () => toggleFav(parseInt(b.dataset.id))));
    document.querySelectorAll(".modal-tab").forEach(t => t.addEventListener("click", () => { state.activeTab = t.dataset.tab; render(); }));
    // Serving calculator events
    document.getElementById("servingMinus")?.addEventListener("click", () => {
        const recipe = state.modal;
        if (!recipe) return;
        const current = state.servings || recipe.srv;
        if (current > 1) {
            state.servings = current - 1;
            render();
        }
    });
    document.getElementById("servingPlus")?.addEventListener("click", () => {
        const recipe = state.modal;
        if (!recipe) return;
        const current = state.servings || recipe.srv;
        if (current < 50) {
            state.servings = current + 1;
            render();
        }
    });
    document.getElementById("resetServings")?.addEventListener("click", () => {
        state.servings = null;
        render();
    });
    document.getElementById("closeModal")?.addEventListener("click", () => { state.modal = null; render(); });
    document.getElementById("modalOverlay")?.addEventListener("click", e => { if (e.target.id === "modalOverlay") { state.modal = null; render(); } });
    document.addEventListener("keydown", e => { if (e.key === "Escape" && state.modal) { state.modal = null; render(); } });
}

function toggleFav(id) {
    state.favs = state.favs.includes(id) ? state.favs.filter(f => f !== id) : [...state.favs, id];
    saveFavs();
    render();
}

// Wait for recipes to load before rendering
if (allRecipes.length > 0) {
    render();
} else {
    window.addEventListener('recipesLoaded', render);
}
    </script>
    <link rel="stylesheet" href="./compliance-styles.css">
    <script src="./cookie-consent.js"></script>
    <script src="./accessibility-menu.js"></script>
</body>
</html>
